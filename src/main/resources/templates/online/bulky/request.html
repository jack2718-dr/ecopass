<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<title>동작구 청소행정</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" th:href="@{/admin/apsol-base.css}">



	<!--    <th:block th:replace="config/csrf :: csrfConfig"/>-->
	<th:block th:replace="config/jquery :: jqueryConfig"/>
	<th:block th:replace="config/toast-ui :: toastUiConfig"/>

	<script th:src="@{/common/js/common.js}"></script>



	<style>
		.pop_detail {width:100%; height:100%; position:fixed; left:0; top:0; display:none; z-index: 9999;}
		.pop_detail2 {width:712px; height:520px; background:white; position:fixed; left:50%; top:50%;
			margin:-260px -361px; border:1px solid #333; }
		.pop_detail .top {width:100%; height:30px; line-height:30px; background:#1A3C70; }
		.pop_detail .top .close {width:30px; height:30px; float:right; margin-right:10px; cursor:pointer;
			text-align:center; }
		.pop_detail .top .close img {height:17px; vertical-align:middle; }
		.pop_detail .content {width:100%; height:100%; padding:30px 20px; margin-top:-30px; }
		.pop_detail .pop_title {width:100%; height:35px; line-height:35px; margin-top:10px; font-weight:bold;
			font-size:17px;  overflow:hidden; }
		.pop_detail input{float: right; border: 1px solid #999; padding: 3px; margin-top: 13px; height: 25px; widht: 30%; font-size: 10pt; }
		.tb_detail_t {width:95%; margin:20px auto 0 auto; border-top:1px solid #333; }
		.tb_detail_t table {width:100%; border-collapse:collapse; }
		.tb_detail_t td {height:25px; text-align:center; background:#f5f5f5; border:none; font-weight:bold;
			box-sizing:border-box; }
		.tb_detail {width:95%; height:300px; margin:auto; border-bottom:1px solid #333; overflow:auto; }
		.tb_detail table {width:100%; border-collapse:collapse; }
		.tb_detail td {height:35px; border:1px solid #ddd; box-sizing:border-box; text-align:center; }
		.tb_detail td:nth-child(1) {border-left:none; text-align:left; padding:0 10px; }
		.tb_detail td:nth-child(2) {text-align:left; padding:0 10px; }
		.tb_detail td:nth-child(4) {border-right:none; }
		.tb_detail .none {text-align:center !important; border:none; }
		.box_bt_detail {margin:30px auto; }
		* { /*박스 안의 모양 잡아줌 */
			box-sizing: border-box;  /* content-box : 콘텐트 영역을 기준으로 크기를 정합니다.
										border-box : 테두리를 기준으로 크기를 정합니다.
										initial : 기본값으로 설정합니다.
										inherit : 부모 요소의 속성값을 상속받습니다.*/
		}

		/* 모바일 */
		@media (max-width:1200px) {
			.pop_detail2 {width:100%; height:100%; position:fixed; left:0; top:0; margin:0; }
			.pop_detail .content {padding:30px 10px; }
			.pop_detail .tb_detail_t td {padding:0 5px; font-size:11px; }
			.pop_detail .tb_detail td {padding:0 5px; font-size:11px; }
			.demo-btns .trigger {
				margin-bottom: 0.8rem;}
		}

		/* 버튼 */

		.demo-btns .info { /*버튼 위치 */
			/*background: #f44336; 가운데 빨간색*/
			padding: 3vh 10vw;
			height: 70vh;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-flow: column wrap;
		}
		.demo-btns p {
			text-align: center;
			color: #fff;
		}
		.demo-btns .link {
			font-size: 20px;
		}
		.demo-btns .trigger {
			margin-right: 3px;
		}
		.box_product .item {
			width: 115px;
			height: 35px;
			line-height: 35px;
			margin: 3px 5px;
			float: left;
			border: 1px solid #ddd;
			overflow: hidden;
			cursor: pointer;
			text-align: center;
			font-size: 10pt;
		}
		.trigger {
			/*position: relative;*/
			/*display: inline-block;*/
			/*padding: 1.2rem 2.4rem;*/
			/*color: rgba(0,0,0,0.7);*/
			/*line-height: 1;*/
			/*cursor: pointer;*/
			/*background: #ffebee;*/
			/*box-shadow: 0 2px 5px 0 rgba(0,0,0,0.26);*/
			/*-webkit-tap-highlight-color: rgba(0,0,0,0);*/
			/*-webkit-user-select: none;*/
			/*-moz-user-select: none;*/
			/*-ms-user-select: none;*/
			/*user-select: none;*/
			/*transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);*/

			width: 115px;
			height: 35px;
			line-height: 35px;
			margin: 3px 5px;
			float: left;
			border: 1px solid #ddd;
			overflow: hidden;
			cursor: pointer;
			text-align: center;
			font-size: 10pt;
		}

		.trigger:hover { /*마우스를 올렸을때 상태변화*/
			background: #ddd;
		}
		.box_bt .box_bt_detail{
			margin: 0 auto;  /* 취소, 확인 버튼 가운데로 */

		}
		.box_bt{
			width: 220px;
			height: 35px;
			line-height: 35px;
		}
		/* 취소버튼 */
		.box_bt .bt {
			width: 100px;
			height: 35px;
			float: left;
			background: #616161;
			color: white;
			cursor: pointer;
			text-align: center;

		}

		.box_bt .bt2 { /* 확인버튼 */
			float: right;
			background: #0E3B64;
		}
		/* 체크박스 */
		.cb {display:none; }
		.cb2 {display:none; }
		.cb_label {padding:0 9px; background:url(/img/cb.png) no-repeat; cursor:pointer; vertical-align:middle; }
		input[type="checkbox"]:checked + .cb_label {background:url(/img/cb_on.png) no-repeat; }

	</style>
</head>
<body>
<!--<div class="demo-btns">-->
<!--	<div class="info">-->
<!--		<button class="trigger" onclick="show_pop_detail();"></button>-->
<!--	</div>-->
<!--</div>-->

<!-- 상세품목팝업 -->
<div class="pop_detail">
	<div class="pop_detail2">
		<div class="top">
			<div class="close" onclick="selectCancle()"><img src="/img/close.png"></div>
		</div>
		<div class="content">
			<div style="display: flex; border-bottom:1px solid #333;"><div class="pop_title">상세선택</div> <input type="text" id="filter" placeholder="품목 검색"></div>
			<div class="tb_detail_t">
				<table><tr><td>품목</td><td>규격</td><td>금액</td><td>선택</td></tr></table>
			</div>
			<input type="hidden" name="sub_seq"/>
			<div class="tb_detail"><table id="subject_table"></table></div>
			<div class="box_bt box_bt_detail">
				<div class="bt" onclick="selectCancle()">취소</div>
				<div class="bt bt2" onclick="detail_select()">확인</div>
			</div>
		</div>
	</div>
</div>
<!-- 상세품목팝업 -->
</body>


<script th:inline="javascript">

	var is_show = false;
	var subjects;
	var isOnline = true;

	function show_pop_detail(is_show, type, point) {  // is_show : 팝업창 출력 여부 , type : 카테고리 태그 , point : 온라인 ? 이건 뭔지 모르겟음.
		console.log(is_show)
		if(! is_show) {
			$('.pop_detail').hide();
			$('body').css('overflow','auto');
		} else {
			var sendData = {'Sub_group':type};
			$.ajax({
				url:'requestCall',
				type:'post',
				data:sendData,
				contentType:'application/x-www-form-urlencoded',
				dataType:'json',
				success:function(data) { callback(data,point); }
			});
			$('.pop_detail .pop_title').html(type);
			$('.pop_detail').show();
			$('body').css('overflow','hidden');
			selected_type = type;
		}
	}
	// 닫기 기능
	function selectCancle(){
		var checkbox = $('.cb');
		for(var i =0; i<checkbox.length; i++){
			var bool = checkbox[i].checked;
			if(bool){
				checkbox[i].checked = false;
			}
		}
		$('.pop_detail').hide();
		$('body').css('overflow', 'auto');
	}
	function detail_select() {
		var anything_seleted = false;
		for(var i=0; i<subjects.length; i++) {
			var sbj = subjects[i];
			if($('#cb_sbj'+i).prop('checked')) { checkOverlapDetail(sbj); anything_seleted = true; }
		}

		if(! anything_seleted) { alert('선택된 품목이 없습니다.'); return; }

		//updateSelected();
		show_pop_detail(false);
	}

	function checkOverlapDetail(sbj) {
		var tmp_index = -1;
		for(var i=0; i<selected.length; i++) {
			if(selected[i]['sub_group'] == sbj["sub_group"] && selected[i]['sub_name'] == sbj["sub_name"]
					&& selected[i]['sub_standard'] == sbj["sub_standard"] && selected[i]['sub_price'] == sbj["sub_price"]
					&& selected[i]['sub_seq'] == sbj["sub_seq"]) {tmp_index = i; }

		}

		if(tmp_index > -1) {
			selected[tmp_index]["sub_cnt"] += 1;
		} else {
			sbj["sub_cnt"] = 1;
			selected.push(sbj);
		}
	}

	// 상세품목 세팅
	function callback(data, type) {
		subjects = data;
		var tmp = '';
		var sortSub = subjects.sort();
		for(var i=0; i<sortSub.length; i++) {
			var item = sortSub[i];
			/* if(type != 'smartLens'){ */
			tmp += '<tr><td>'+item['sub_name']+'</td><td>'+item['sub_standard']+'</td><td>'+comma(item['sub_price'])+'</td>'
					+'<td>'+getCbForm('cb_sbj' + i)+'</td></tr>';
			/* }else{
                tmp += '<tr><td>'+item['sub_name']+'</td><td>'+item['sub_standard']+'</td><td>'+comma(item['sub_price'])+'</td>'
                +'<td>'+getCbForm('cb_sbj' + i)+'</td></tr>';
            } */

		}
		$('.tb_detail table').html(tmp);

		if(sortSub.length == 0) {
			var none = '<tr><td colspan="4" style="text-align:center; border:none;">표시할 내용이 없습니다</td></tr>';
			$('.tb_detail table').html(none);
		} else {
			$(window).resize(function() {
				for(var i=1; i<=3; i++) {
					var width = $('.tb_detail td:nth-child('+i+')').outerWidth();
					$('.tb_detail_t td:nth-child('+i+')').css({'width':width});
				}
			}).resize();
		}

	}

	// 세자리마다 콤마
	function comma(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}

	// checkbox 폼
	function getCbForm(id, onclick, padding, checked) {
		if (!onclick)
			onclick = '';
		if (!padding)
			padding = 0;
		if (!checked)
			checked = '';
		return '<input class="cb" type="checkbox" id="'+id+'" name="'+id+'" onchange="'+onclick+'" '+checked+'>'
				+ '<label class="cb_label" style="padding:'+padding+'px 9px;" for="'+id+'"></label>';
	}

	// 선택목록 업데이트
	function updateSelected() {

		var total_price = 0;
		var tmp = '<tr class="title"><td style="display:none">NO</td><td>품목</td><td style="width:20%;">수량</td><td style="width:20%;">금액</td><td style="width:5%;">비고</td></tr>';
		for(var i=0; i<selected.length; i++) {
			var item = selected[i];
			$('input[name=btnCnt]').val((i*1));
			if(!isOnline){
				tmp +=  '<tr><td style="display:none">'+item["sub_seq"]+'</td><td class="first_row">'+item["sub_name"]
						+'<input type="text" class="form-control" style="display: inline; width: 200px; height: 25px; margin: 0 10px;" name="req_atc'+i+'" value="'+item["sub_standard"]+'"/>'
						+'<button class="btn btn-light btn-sm atcChk" name="atcSetting'+i+'" style="border-color: #abacad66; margin-left: 10px;" onclick="atcSetting('+i+')">등록</button><input type="hidden" name="atcSeq'+i+'" value="'+item["sub_seq"]+'"/>'
						+'</td><td><img src="/img/minus.png" onclick="oc_selected_num('+i+',-1)"> '
						+'<span class="num_product">'+item["sub_cnt"]+'</span> <img src="/img/plus.png" onclick="oc_selected_num('+i+',1)"></td><td>'
						+comma(item["sub_price"]*item["sub_cnt"])+'</td><td><img src="/img/delete.png" onclick="oc_selected_num('+i+',0)"></td></tr>';
				total_price += item["sub_price"]*item["sub_cnt"];
			}else{
				tmp +=  '<tr><td style="display:none">'+item["sub_seq"]+'</td><td class="first_row">'+item["sub_name"]+'('+item["sub_standard"]+')</td><td><img src="/img/minus.png" onclick="oc_selected_num('+i+',-1)"> '
						+'<span class="num_product">'+item["sub_cnt"]+'</span> <img src="/img/plus.png" onclick="oc_selected_num('+i+',1)"></td><td>'
						+comma(item["sub_price"]*item["sub_cnt"])+'</td><td><img src="/img/delete.png" onclick="oc_selected_num('+i+',0)"></td></tr>';
				total_price += item["sub_price"]*item["sub_cnt"];
			}


		}

		if(selected.length == 0) tmp += '<tr><td colspan="4">표시할 내용이 없습니다.</td></tr>';
		$('.tb_selected').html(tmp);

		var radio = $('input[name="lgd_paytype"]:checked').val();
		// 총금액
		if(radio!="NONE"){
			$('.total_price').html('합계 : '+comma(total_price)+'원');
		}else{
			$('.total_price').html('합계 : 0원');
		}

	}

	function atcSetting(num){

		var i = 0;
		i = $('input[name=btnClickChk]').val();
		i *= 1;
		$('input[name=btnClickChk]').val(i+1);

		var req_atc = $('input[name=req_atc'+num+']').val();
		var sub_seq = $('input[name=atcSeq'+num+']').val();

		if(!atcs){
			atcs = sub_seq+"\|"+req_atc;
		}else {
			atcs += "\||"+sub_seq+"\|"+req_atc;
		}

		$('input[name=req_atc]').val(atcs);
		$('input[name=req_atc'+num+']').attr('disabled','disabled');
		$('button[name=atcSetting'+num+']').attr('disabled','disabled');
	}

	// 개수 조절
	function oc_selected_num(target_index, plus) {
		if (plus != 0) {
			selected[target_index]["sub_cnt"] += plus;
			if (selected[target_index]["sub_cnt"] < 1)
				selected.splice(target_index, 1);
		} else {
			selected.splice(target_index, 1);
		}

		updateSelected();
	}

	// 초기화
	function init_signup(){
		//
		// init_subHeader('Home > 온라인신청 > 배출신청');
		// init_leftMenu(1, 'request');
		//
		// $('.form_request input[name=exhaust_date]').val(getFuture(0));
		// setDatePicker($('.form_request input[name=exhaust_date]'));
		// setNotPrev($('.form_request input[name=exhaust_date]'));

		var menus = [[${categories}]]; // 메뉴카테고리 -> 전체, 가구류, 가전제품, 낸난방기

		var tmp = '';
		for(var i=0; i<menus.length; i++) {
			tmp += '<div class="item" onclick="show_pop_detail(true, \''+menus[i]+'\', \'online\')">'+menus[i]+'</div>';
		}
		//tmp += '<div class="item" onclick="openSubjectPopup()">무상수거대상</div>';
		tmp += '<div class="clear_both"></div>';
		$('.box_product').html(tmp);

		// 선택한 목록 업데이트
		updateSelected();

	}

	function init_signup(){

		// init_subHeader('Home > 온라인신청 > 배출신청');
		// init_leftMenu(1, 'request');

		// $('.form_request input[name=exhaust_date]').val(getFuture(0));
		// setDatePicker($('.form_request input[name=exhaust_date]'));
		// setNotPrev($('.form_request input[name=exhaust_date]'));

		var menus = [[${categories}]]; // 메뉴카테고리 -> 전체, 가구류, 가전제품, 낸난방기

		var tmp = '';
		for(var i=0; i<menus.length; i++) {
			tmp += '<div class="item" onclick="show_pop_detail(true, \''+menus[i]+'\', \'online\')">'+menus[i]+'</div>';
		}
		// tmp += '<div class="item" onclick="openSubjectPopup()">무상수거대상</div>';
		tmp += '<div class="clear_both"></div>';
		$('.box_product').html(tmp);

		// 선택한 목록 업데이트
		updateSelected();

	}


</script>


</html>